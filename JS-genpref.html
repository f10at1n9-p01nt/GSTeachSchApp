<script>

  const prefDropdowns = document.getElementsByClassName("accordian");

  for (let i = 0; i < prefDropdowns.length; i++) {
    prefDropdowns[i].addEventListener('click', function() {
      console.log(prefDropdowns)
      this.classList.toggle("active");
      let panel = this.nextElementSibling;

      if (panel.style.maxHeight) {
        panel.style.maxHeight = null; // accordian is open, so need to remove height
      } else {
        panel.style.maxHeight = panel.scrollHeight + "px"; // accordian is closed, so need to add height back in
      }
    });
  }

  const updatePrefencesButton = document.getElementById('update-preferences').addEventListener('click', clicked)
  const retrievePrefencesButton = document.getElementById('pull-preferences').addEventListener('click', pullPreferences)
  const expandButton = document.getElementById('expand-all').addEventListener('click', expandAll)
  const collapseButton = document.getElementById('collapse-all').addEventListener('click', collapseAll)

  function clicked() {
    console.log(username.value);
  }


  // Expands all courses
  function expandAll() {
    const panels = document.getElementsByClassName('panel')

    for (let i = 0; i < panels.length; i++) {
      // panels[i].style.maxHeight = panels[i].scrollHeight + "px";
      panels[i].style.maxHeight = 'min-content';
    }
  }


  // Helper function to open both courses and time of day when page loads
  function openAll() {
    document.getElementsByClassName('panel-dt')[0].style.maxHeight = 'min-content';

    expandAll();
  }


  // Collapses all courses
  function collapseAll() {
    const panels = document.getElementsByClassName('panel')

    for (let i = 0; i < panels.length; i++) {
      panels[i].style.maxHeight = null;
    }
  }


  function pullPreferences() {
    const username = document.getElementById('username').value.toLowerCase();

    google.script.run.withSuccessHandler(updateCheckboxes).getPreferences(username)
  }


  function updateCheckboxes(prefArr) {
    const dayPrefArr = prefArr[0];
    const coursePrefArr = prefArr[1];
    
    const classesDiv = document.getElementById('pref-classes');
    const timeOfDayDiv = document.getElementById('pref-time');
    const classCheckboxes = classesDiv.querySelectorAll('input');
    const timeCheckboxes = timeOfDayDiv.querySelectorAll('input');

    for (let i = 0; i < timeCheckboxes.length; i++) {
      if (dayPrefArr[i] === 1) {
        timeCheckboxes[i].checked = true;
      } else {
        timeCheckboxes[i].checked = false;
      }
    }

    for (let i = 0; i < classCheckboxes.length; i++) {
      if (coursePrefArr[i] === 1) {
        classCheckboxes[i].checked = true;
      } else {
        classCheckboxes[i].checked = false;
      }
    }
  }

  document.addEventListener("DOMContentLoaded", openAll);

</script>
