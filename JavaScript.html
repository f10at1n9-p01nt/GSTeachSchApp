<script>

  document.getElementById("submit").addEventListener("click", userClicked);
  // document.getElementById('username').addEventListener('input', userTyped);
  document.getElementById("submit-preferences").addEventListener("click", submitPreferences);
  // document.getElementById("submit-preferences").addEventListener("click", getRankedIds);


  function userClicked() {
    console.log("here");
    google.script.run.withSuccessHandler(printSchedule).checkSchedule(document.getElementById('username').value)
  }


// Buggy - text doesn't stay on screen
  // function userTyped(e) {
  //   google.script.run.withSuccessHandler(printSchedule).checkSchedule(e.target.value);
  // }


  function printSchedule(schedule) {
    const here = document.getElementById('here');
    // here.textContent = schedule;

    while (here.firstChild) {
      here.removeChild(here.lastChild);
    }

    for (let i = 0; i < schedule.length; i++) {
      let newEl = document.createElement('li');
      newEl.classList.add("ml-5", "mt-3");
      let newText = document.createTextNode(`${schedule[i][0]} ${schedule[i][1]}`)
      newEl.appendChild(newText);
      here.appendChild(newEl);
    }
  }



  function submitPreferences() {
    const usernameField = document.getElementById('username');
    const username = usernameField.value;

    const coursePreferences = getRankedIds();

    google.script.run.addUsername(username, coursePreferences);

    console.log(`${username} clicked the button`)
    usernameField.value = '';
  }

// <li><input type="number" min="1" max="10">${classData[i][0]} ${classData[i][1]} ${classData[i][3]} ${classData[i][4]} ${classData[i][5]} ${classData[i][7]} </li>
  function getRankedIds() {
    const ul = document.getElementById('class-list');
    const classes = ul.getElementsByTagName("li");
    let rankId = [];

    for (let i = 0; i < classes.length; i++) {
      if (classes[i].querySelector("input").valueAsNumber) {
        let idArr = classes[i].innerHTML.split('>');
        idArr.shift();
        rankId.push([classes[i].querySelector("input").valueAsNumber, idArr[0].split(' ')[0]]);
      }
    }

    return rankId;
  }

</script>